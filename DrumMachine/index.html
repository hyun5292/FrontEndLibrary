<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css"/>
    <link rel="stylesheet" href="./css/default.css">
    <link rel="stylesheet" href="./css/index.css">
    <title>Drum Machine</title>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <script type="text/babel">
        const projectName = 'drum-machine';

        const bankOne = [
            {
                keyCode: 81,
                keyTrigger: 'Q',
                id: 'Heater-1',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/Heater-1.mp3'
            },
            {
                keyCode: 87,
                keyTrigger: 'W',
                id: 'Heater-2',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/Heater-2.mp3'
            },
            {
                keyCode: 69,
                keyTrigger: 'E',
                id: 'Heater-3',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/Heater-3.mp3'
            },
            {
                keyCode: 65,
                keyTrigger: 'A',
                id: 'Heater-4',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/Heater-4_1.mp3'
            },
            {
                keyCode: 83,
                keyTrigger: 'S',
                id: 'Clap',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/Heater-6.mp3'
            },
            {
                keyCode: 68,
                keyTrigger: 'D',
                id: 'Open-HH',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/Dsc_Oh.mp3'
            },
            {
                keyCode: 90,
                keyTrigger: 'Z',
                id: "Kick-n'-Hat",
                url: 'https://s3.amazonaws.com/freecodecamp/drums/Kick_n_Hat.mp3'
            },
            {
                keyCode: 88,
                keyTrigger: 'X',
                id: 'Kick',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/RP4_KICK_1.mp3'
            },
            {
                keyCode: 67,
                keyTrigger: 'C',
                id: 'Closed-HH',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/Cev_H2.mp3'
            }
        ];

        const bankTwo = [
            {
                keyCode: 81,
                keyTrigger: 'Q',
                id: 'Chord-1',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/Chord_1.mp3'
            },
            {
                keyCode: 87,
                keyTrigger: 'W',
                id: 'Chord-2',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/Chord_2.mp3'
            },
            {
                keyCode: 69,
                keyTrigger: 'E',
                id: 'Chord-3',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/Chord_3.mp3'
            },
            {
                keyCode: 65,
                keyTrigger: 'A',
                id: 'Shaker',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/Give_us_a_light.mp3'
            },
            {
                keyCode: 83,
                keyTrigger: 'S',
                id: 'Open-HH',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/Dry_Ohh.mp3'
            },
            {
                keyCode: 68,
                keyTrigger: 'D',
                id: 'Closed-HH',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/Bld_H1.mp3'
            },
            {
                keyCode: 90,
                keyTrigger: 'Z',
                id: 'Punchy-Kick',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/punchy_kick_1.mp3'
            },
            {
                keyCode: 88,
                keyTrigger: 'X',
                id: 'Side-Stick',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/side_stick_1.mp3'
            },
            {
                keyCode: 67,
                keyTrigger: 'C',
                id: 'Snare',
                url: 'https://s3.amazonaws.com/freecodecamp/drums/Brk_Snr.mp3'
            }
        ];

        const activeStyle = { 
            marginTop: 13,
            height: 77,
            boxShadow: '0 3px orange',
            backgroundColor: 'orange'
        };

        const inactiveStyle = {
            marginTop: 10,
            boxShadow: '3px 3px 5px black',
            backgroundColor: 'grey'
        };

        class DrumPad extends React.Component {
            constructor(props) {
                super(props);
                this.state = {
                    padStyle: inactiveStyle
                };
                this.playSound = this.playSound.bind(this);
                this.handleKeypress = this.handleKeypress.bind(this);
                this.activatePad = this.activatePad.bind(this);
            }

            componentDidMount() {
                document.addEventListener('keydown', this.handleKeypress);
            }

            componentWillUnmount() {
                document.removeEventListener('keydown', this.handleKeypress);
            }

            handleKeypress(e) {
                if(e.keyCode === this.props.keyCode) {
                    this.playSound();
                }
            }

            activatePad() {
                
            }
        };

        class App extends React.Component {
            constructor(props) {
                super(props);
                this.state = {
                    power: true,
                    display: String.fromCharCode(160),
                    currentPadBank: bankOne,
                    currentPadBankId: 'Heater Kit',
                    sliderVal: 0.3
                };
                this.displayClipName = this.displayClipName.bind(this);
                this.selectBank = this.selectBank.bind(this);
                this.adjustVolume = this.adjustVolume.bind(this);
                this.powerControl = this.powerControl.bind(this);
                this.clearDisplay = this.clearDisplay.bind(this);
            }
            //power 버튼 누르면
            powerControl() {
                this.setState({
                    power: !this.state.power,  //현 상태는 반대로
                    display: String.fromCharCode(160)  
                });
            }
            //Bank 버튼 누르면
            selectBank() {
                if(this.state.power) {  //Power가 켜저있으면
                    if(this.state.currentPadBankId  === 'Heater Kit') {  //현재 Heater Kit면
                        this.setState({
                            currentPadBank: bankTwo,  //Smooth Piano Kit가 bank2번이구나
                            display: 'Smooth Piano Kit',
                            currentPadBankId: 'Smooth Piano Kit'
                        });
                    } else {  //현재 Smooth Piano Kit면
                        this.setState({
                            currentPadBank: bankOne,  //Smooth Piano Kit가 bank1번이구나
                            display: 'Heater Kit',
                            currentPadBankId: 'Heater Kit'
                        });
                    }
                }
            }
            //현재 선택된 Bank를 화면에 띄워주는 함수? 메서드? 컴포넌트?
            displayClipName(name) {
                if(this.state.power) {  //Power가 켜저있으면
                    this.setState({
                        display: name
                    });
                }
            }
            //볼륨바 설정
            adjustVolume(e) {
                if(this.state.power) {  //Power가 켜저있으면
                    this.setState({
                        sliderVal: e.target.value,  //현재 값
                        display: 'Volume: ' + Math.round(e.target.value * 100)
                    });
                    setTimeout(() => this.clearDisplay(), 1000);  //1초후에 clearDisplay() 실행
                }
            }

            clearDisplay() {
                this.setState({
                    display: String.fromCharChode(160)
                });
            }

            render() {
                const powerSlider = this.state.power //전원이 켜져있으면
                    ? { float: 'right' }  //버튼 위치 오른쪽
                    : { float: 'left' };  //버튼 위치 왼쪽
                const bankslider = this.state.currentPadBank === bankOne  //Smooth Piano Kit
                    ? { float: 'left' }  //버튼 위치 오른쪽
                    : { float: 'right' };  //버튼 위치 왼쪽
                const clips = [].slice.call(document.getElementByClassName('clip'));
                clips.forEach(sound => {
                    sound.volume = this.state.sliderVal;
                });

                return (
                    <div class="inner-container" id="drum-machine">
                        <PadBank 
                            clipVolume={this.state.sliderVal}
                            currentPadBank={this.state.currentPadBank}
                            power={this.state.power}
                            updateDisplay={this.displayClipName} />
                        <div class="logo">
                            <div class="inner-logo">{'FCC' + String.fromCharCode(160)}</div>
                            <i class="inner-logo fa fa-free-code-camp" />
                        </div>
                        <div class="controls-container">
                            <div class="control">
                                <p>Power</p>
                                <div class="select" onClick={this.powerControl}>
                                    <div class="inner" style={powerSlider} />
                                </div>
                            </div>
                            <div id="display">{this.state.display}</div>
                            <div class="volume-slider">
                                <input 
                                    max='1'
                                    min='0'
                                    onChange={this.adjustVolume}
                                    step='0.01'
                                    type='range'
                                    value={this.state.sliderVal} />
                            </div>    
                            <div class="control">
                                <p>Bank</p>
                                <div class="select" onClick={this.selectBank}>
                                    <div class="inner" style={bankSlider} />
                                </div>
                            </div>    
                        </div>
                    </div>
                );
            }
        };

        ReactDOM.render(<App />, document.getElementById("root"));
    </script>
</body>
</html>